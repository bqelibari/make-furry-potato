.DEFAULT_GOAL: clean
builddir := build
subdirs := $(wildcard */)
subdir_sources := $(wildcard $(addsuffix *.c,$(subdirs)))
sources := $(wildcard *.c) $(subdir_sources)

c_objects := $(patsubst %.c,%.o,$(sources))
fib_fast_objects := $(filter-out %_slow.o, $(c_objects))
fib_slow_objects := $(filter-out %_fast.o, $(c_objects))
vpath %.h ../headers

all: objects fib_fast fib_slow

objects: $(c_objects) | $(builddir)

fib_fast: $(fib_fast_objects)
	gcc -o $@ $(fib_fast_objects)

fib_slow: $(fib_slow_objects)
	gcc -o $@ $(fib_slow_objects)

clean:
	rm -f $(c_objects) fib_fast fib_slow

hi.o:
	gcc -M ./fib_slow_dir/fib_slow.c -o hi.o